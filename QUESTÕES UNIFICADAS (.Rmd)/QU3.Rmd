---
output: html_document
---
#QUESTÕES UNIFICADAS
```{r, include=FALSE}
library("mime")
library("stringi")
library("magrittr") 
library("Rcpp")
library("evaluate")
library("digest")
library("formatR")
library("highr")
library("markdown")
library("stringr")
library("yaml")
library("bitops")
library("caTools")
library("htmltools")
library("knitr")
library("rmarkdown")
library("e1071")
library("fBasics")
library("DAAG")
library("MASS")
library("fdth")
library("dplyr")
library("moments")
library("qcc")
library("rafalib")
library("reshape2")
library("survey")
library("raster")
library("knitr")
```

##QUESTÃO QU3
O processo de geração e distribuição de vapor, bem como o sistema de co-geração, de uma determinada indústria podem ser representados pela figura 1. O primeiro controlador (PC-1) controla a pressão do sistema de distribuição de vapor de média pressão (15 kgf/cm2) em uma faixa de modo a evitar que fique abaixo de um valor requerido. Para isto, quando ocorre diminuição da pressão do sistema de distribuição de vapor, o controlador PC-1 comanda a abertura de uma válvula redutora de pressão que injeta vapor diretamente na linha de distribuição, sem passar pela turbina. O segundo controlador (PC-2) controla a pressão do sistema de distribuição de vapor em outra faixa, evitando que a pressão fique acima de um valor definido como seguro para o processo. Para fazer esse controle, o PC-2 comanda a abertura de uma válvula de alívio que lança na atmosfera o excesso de vapor, gerando perdas de vapor e, consequentemente, de água e energia.

```{r, echo=FALSE}
setwd(paste(getwd(),"/DBQU",sep=""))

LQQU3 <- read.table(file = "LQQU3.txt",
                      header = TRUE)
LQQU3.1 <- read.table(file = "LQQU3.1.txt",
                      header = TRUE)
knitr::kable(LQQU3, align = 'c')

setwd("../")
```

```{r, echo=FALSE}
sumario.perda <- as.vector(summary(LQQU3$Perda))
sd.perda <- as.vector(round(sd(LQQU3$Perda), digits = 2))
a <- matrix(c(sumario.perda, sd.perda), nrow = 1, ncol = 7)


sumario.perda.so <- as.vector(summary(LQQU3.1$Perda))
sd.perda.so <- as.vector(round(sd(LQQU3.1$Perda), digits = 2))
b <- matrix(c(sumario.perda.so, sd.perda.so), nrow = 1, ncol = 7)

c <- rbind(a, b)
rownames(c) <- c("% Perda", "% Perda (sem outlier)")
colnames(c) <- c("Min", "Q1", "Mediana", "Média", "3Q", "Max", "DesPad")
knitr::kable(c, align = 'c')

par(mfrow = c(1,2))
boxplot(x = LQQU3$Perda,
        xlab = "% Perda",
        ylab = "Dados")
boxplot(x = LQQU3.1$Perda,
        xlab = "% Perda (sem outlier)",
        ylab = "Dados")
hist(x = LQQU3$Perda,
     main = "",
     xlab = "% Perda",
     ylab = "Frequência Absoluta")
hist(x = LQQU3.1$Perda,
     main = "",
     xlab = "% Perda (sem outlier)",
     ylab = "Frequência Absoluta")
```

**Adicionar figura da questão!**

A Figura 2 mostra que 40% da perda de vapor pode ser explicada pela relação entre a geração de energia elétrica pelas turbinas, sendo esta e o alívio de vapor as principais fontes de variação a serem analisadas. Na Tabela 1 são apresentados os dados de perda de vapor e consumo de energia elétrica.

a) Estime as estatísticas descritivas de média e desvio padrão dos dados referentes a perda de vapor da Tabela 1 considerando um nível de confiança de 95%. Discuta os resultados considerando as informações apresentadas no Quadro 1 e Figura 1.

b) Selecionando-se uma unidade amostral ao caso: (a) Qual a probabilidade que esta amostra tenha perda superior a 25%. (b) Qual deve ser a perda de vapor para que 95% da perda seja inferior a 25%?

c) **(a)** Considerando que o engenheiro responsável pelo processo acha o intervalo estimado no item 1(a) muito grande, quantas amostrar ele deveria ter para um intervalo de 95% com erro menor que 0,5% de perdas de vapor? **(b)** Esperava-se que a perda média de vapor da unidade não ultrapasse 18%, ao nível de confiança de 95%, para que não haja atuação manual no processo. Verifique se este procedimento deve ser alterado com base na teoria de teste de hipóteses. Avalie a influência da alteração do nível de confiança para 99% sobre os erros do tipo 1 para este sistema.

d) Acredita-se que os dados de perda de vapor (t/mês) e produção (t/mês) sejam correlacionados.

d.1. Verifique se essa afirmação é verdadeira considerando os resultados apresentados no Quadro 2 e Figura 4. Não se esqueça de utilizar também a teoria do teste de hipóteses nas suas justificativas.

```{r, echo=FALSE}
modelo.QU3 <- lm(formula = Perda.Total ~ Producao.Total, data = LQQU3)
summary(modelo.QU3)

par(mfrow = c(2,2))
qqnorm(modelo.QU3$residuals, pch = 20, col = "red")
qqline(y = modelo.QU3$residuals, col = 4, lwd=2,lty=2)
plot(x = modelo.QU3$fitted.values, y = modelo.QU3$residuals,
     main = "Resíduos X Valores Ajustados",
     ylab = "Resíduos",
     xlab = "Valores Ajustados",
     pch = 20,
     col = "red")
lines.default(rep(0, 9000), col = "black")
hist(x = modelo.QU3$residuals,
     main = "Histograma dos Resíduos",
     ylab = "Frequência Absoluta",
     xlab = "Resíduos",
     col = "grey")
plot(x = seq(1,nrow(LQQU3)), y = modelo.QU3$residuals,
     main = "Resíduos X Observação",
     ylab = "Resíduos",
     xlab = "Observação",
     type = "l",
     col = "blue")
points(modelo.QU3$residuals, pch = 20, col = "red")
lines.default(rep(0, 9000), col = "black")
```

d.2. Proponha um algoritmo para construção de um modelo de regressão multivariado. Considere que variações na temperatura ambiente, pressão na linha de distribuição e percentual de condensado na linha podem causar variações na perda de vapor. Considere a possibilidade de existir diferentes padrões por turno de produção (7-15h, 15-23h, 23-07h), relações não lineares, correlação entre variáveis preditoras, valores aberrantes, etc.

###Resposta letra a)
```{r}
n         <- nrow(LQQU3)
xbarra    <- mean(LQQU3$Perda)
sd.perda  <- sd(LQQU3$Perda)
var.perda <- var(LQQU3$Perda)
alpha = 0.05

LI.mu.perda <- xbarra - qt(p = alpha/2, df = n-1, lower.tail = FALSE)*sd.perda/sqrt(n)
LS.mu.perda <- xbarra + qt(p = alpha/2, df = n-1, lower.tail = FALSE)*sd.perda/sqrt(n)

LI.var.perda <- ((n-1)*sd.perda^2)/qchisq(0.95, df = n-1, lower.tail = TRUE)
LS.var.perda <- ((n-1)*sd.perda^2)/qchisq(0.05, df = n-1, lower.tail = TRUE)

a <- matrix(c(LI.mu.perda, LS.mu.perda, LI.var.perda, LS.var.perda), nrow = 2, ncol = 2)
colnames(a) <- c("Média", "Variância")
rownames(a) <- c("LI", "LS")
knitr::kable(a, align = 'c')
```

```{r}
n         <- nrow(LQQU3.1)
xbarra    <- mean(LQQU3.1$Perda)
sd.perda  <- sd(LQQU3.1$Perda)
var.perda <- var(LQQU3.1$Perda)
alpha = 0.05

LI.mu.perda <- xbarra - qt(p = alpha/2, df = n-1, lower.tail = FALSE)*sd.perda/sqrt(n)
LS.mu.perda <- xbarra + qt(p = alpha/2, df = n-1, lower.tail = FALSE)*sd.perda/sqrt(n)

LI.var.perda <- ((n-1)*sd.perda^2)/qchisq(0.95, df = n-1, lower.tail = TRUE)
LS.var.perda <- ((n-1)*sd.perda^2)/qchisq(0.05, df = n-1, lower.tail = TRUE)

a <- matrix(c(LI.mu.perda, LS.mu.perda, LI.var.perda, LS.var.perda), nrow = 2, ncol = 2)
colnames(a) <- c("Média (sem outlier)", "Variância (sem outlier)")
rownames(a) <- c("LI", "LS")
knitr::kable(a, align = 'c')
```

###Resposta letra b)
A probabilidade que esta amostra tenha perda superior a 25% é:
```{r}
T0 <- (25 - mean(LQQU3$Perda))/(sd(LQQU3$Perda)/sqrt(nrow(LQQU3)))
pt(q = T0, df = nrow(LQQU3.1)-1, lower.tail = FALSE)
```

A perda de vapor para que 95% da perda seja inferior a 25% é:
```{r}
T0 <- qt(p = 0.95, df = nrow(LQQU3.1)-1)
round(T0*(sd(LQQU3$Perda)/sqrt(nrow(LQQU3)))+mean(LQQU3$Perda), digits = 2)
```

###Resposta letra c)
**c.(a)**
```{r}
E <- 0.5
n <- ((qt(p = 0.05/2, df = nrow(LQQU3)-1, lower.tail = FALSE)*sd(LQQU3$Perda))/E)^2
print(round(n))
```

**c.(b)**
```{r}
t.test(x = LQQU3$Perda,
       mu = 18,
       alternative = "less",
       conf.level = 0.95)

t.test(x = LQQU3.1$Perda,
       mu = 18,
       alternative = "less",
       conf.level = 0.95)
```

Realizou-se um teste T para avaliar se a perda média de vapor da unidade é inferior a 18%. Os testes foram realizados considerando os dados com e sem a presença de outliers.

O teste T, para o conjunto total de dados, falhou em rejeitar a hipótese nula na qual a perda de vapor é igual a 18%. Com base na teoria de teste de hipótese este procedimento deve ser alterado, pois não é possível afirmar que a média da perda de vapor é inferior a 18%.

Já o teste T, para o conjunto de dados sem outliers, rejeitou a hipótese nula na qual a perda de vapor é igual a 18%. Com base na teoria de teste de hipótese não é necessário alterar este procedimento, pois a média verdadeira da perda de vapor será inferior a 18% em 95% das amostragens.

Construiu-se o código abaixo para avaliar a influência da alteração do nível de confiança para 99% sobre os erros do tipo 1 para este sistema.

```{r}
t.test(x = LQQU3$Perda,
       mu = 18,
       alternative = "less",
       conf.level = 0.99)

t.test(x = LQQU3.1$Perda,
       mu = 18,
       alternative = "less",
       conf.level = 0.99)
```

O aumento do nível de confiânça (diminuição do nível de significância alpha) torna inviável a rejeição da hipótese nula na qual a perda de vapor é igual a 18% para ambos os casos (com e sem outlier). Isso significa que, com base na teoria de teste de hipótese, é necessário alterar este procedimento, pois a média verdadeira da perda de vapor não será inferior a 18% em 99% das amostragens.

###Resposta letra d)