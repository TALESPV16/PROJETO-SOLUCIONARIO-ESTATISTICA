---
output: html_document
---
#QUESTÕES UNIFICADAS
```{r, include=FALSE}
library("mime")
library("stringi")
library("magrittr") 
library("Rcpp")
library("evaluate")
library("digest")
library("formatR")
library("highr")
library("markdown")
library("stringr")
library("yaml")
library("bitops")
library("caTools")
library("htmltools")
library("knitr")
library("rmarkdown")
library("e1071")
library("fBasics")
library("DAAG")
library("MASS")
library("fdth")
library("dplyr")
library("moments")
library("qcc")
library("rafalib")
library("reshape2")
library("survey")
library("raster")
library("knitr")
```

##QUESTÃO QU1
A demanda bioquímica de oxigênio (DBO em mg/L) foi obtida a partir de uma pesquisa em resíduos industriais. Noventa e nove (99) observações foram levantadas a cada 4 horas, fornecendo seis (6) observações diárias para 16 dias, mais três (3) observações no 17o dia. O entendimento do comportamento horário e composto (média diária) será necessário para projetar o tratamento do processo. Os padrões de variação também precisam ser vistos porque eles influenciam, por exemplo, a exeqüibilidade em utilizar-se unidades de equalização do processo para reduzir as variações de carga de DBO. Os dados podem ter propriedades interessantes, assim a apresentação deve ser completamente clara e não estar aberta para interpretações confusas.

```{r, echo=FALSE, warning=FALSE}
setwd(paste(getwd(),"/DBQU",sep=""))

LQQU1.1 <- read.table(file = "LQQU1.1.txt",
                      header = TRUE)
knitr::kable(LQQU1.1, align = 'c')

LQQU1.2 <- read.table(file = "LQQU1.2.txt",
                      header = TRUE)
knitr::kable(LQQU1.2, align = 'c')

setwd("../")
```

a) Do ponto de vista estatístico, qual a importância de avaliar a concentração de DBO por período de amostragem (4h, 8h, 12h, 16h, 20h, e 24h) ao invés de utilizar unicamente a DBO média para as análises posteriores?

b) Avalie se a concentração de DBO horária média varia significativamente durante 24h de operação. Descreva todas as premissas necessárias para basear sua análise. Quando necessário, considere um nível de confiança de 90%.

c) Um dos critérios estabelecidos para avaliar a inviabilidade técnica de instalação de uma unidade de tratamento da DBO é baseada na avaliação da probabilidade em que a DBO horária exceda os limites de especificação. Considera-se o processo de tratamento inviável se a probabilidade da DBO (mg/L) ultrapassar o seu valor médio + 10% for igual ou superior a 30%. Pergunta-se, este processo é viável tecnicamente? Justifique sua resposta.

### Resposta letra a)
Do ponto de vista estatístico, as diferentes divisões do período de amostragem dos dados coletados para a avaliação da concentração de DBO permite o maior entendimento do comportamnto horario e composto da concentração do mesmo. A divisão horária por período de amostragem permite a identificação de padrões e tendéncias ao longo do dia, possibilitando um entendimento maior do processo de tratamento, o que facorece a execução de ações para redução da variação da carga de DBO.A simples utilização do comportamento composto (média diária) da concentração de DBO pode comprometer o claro entendimento das variações do processo ao longo do dia, tornando ineficientes as futuras iniciativas para redução da variação de carga de DBO. A análise da variação da média diária permite a identifiação de padrões e tendências da variação de DBO relacionadas à sazionaloidade em períodos maiores (semanas, meses, anos, etc.), negligenciando a sensibilidade quanto às variações horárias ao longo do dia necessárias para projetar o tratamento do processo.

### Resposta letra b)
```{r}
plot(x = LQQU1.2$Amostra,
     y = LQQU1.2$Media,
     main = "DBO (mg/L) média a cada 4 horas",
     ylab = "DBO (mg/L)",
     xlab = "Tempo (h)",
     type = "l")
points(LQQU1.2, pch = 16, col = "red")

dp4h  <- LQQU1.2$DP[1]
dp8h  <- LQQU1.2$DP[2]
dp12h <- LQQU1.2$DP[3]
dp16h <- LQQU1.2$DP[4]
dp20h <- LQQU1.2$DP[5]
dp24h <- LQQU1.2$DP[6]

mu4h  <- LQQU1.2$Media[1]
mu8h  <- LQQU1.2$Media[2]
mu12h <- LQQU1.2$Media[3]
mu16h <- LQQU1.2$Media[4]
mu20h <- LQQU1.2$Media[5]
mu24h <- LQQU1.2$Media[6]

Dif.24h <- function(mean1, sd1, mean2, sd2, alpha = 0.1, n1 = 99, n2 = 99) {
        F0 <- sd1^2 / sd2^2
        
        f.alpha <- qf(p = alpha/2, df1 = n1-1, df2 = n1-1, lower.tail = FALSE)
        
        LS.F <- (sd1^2 / sd2^2)*f.alpha
        
        LI.F <- (sd1^2 / sd2^2)*(1/f.alpha)
                
        if (F0 > f.alpha) {
                print("Rejeitar Hipótese Nula - Existe Diferença entre as Variâncias")
                
                v <- (((sd1^2/n1)+(sd2^2/n2))^2)/(((sd1^2/n1)^2)/(n1-1)+((sd2^2/n2)^2)/(n2-1))
                
                T0 <- (mean1-mean2) / sqrt((sd1^2/n1)+(sd2^2/n2))
                
                t.alpha <- abs(qt(p = alpha/2, df = round(v)))
                
                p.value.T0 <- pt(q = T0, df = round(v), lower.tail = FALSE)*2
                
                if (T0 > t.alpha) {
                        print("Rejeitar Hipótese Nula - Existe Diferença entre as Médias")
                        knitr::kable(data.frame(p.value.T0), align = 'c')
                }else {
                        print("Falhar em Rejeitar a Hipótese Nula - Não Exite Diferença Significativa entre as Médias")
                        knitr::kable(data.frame(p.value.T0), align = 'c')
                }
        }else {
                print("Falhar em Rejeitar a Hipótese Nula - Não Exite Diferença Significativa  entre as Variâncias")
                sp2 <- ((n1-1)*sd1^2 + (n2-1)*sd2^2) / (n1+n2-2)
                
                sp <- sqrt(sp2)
                
                T0 <- (mean1-mean2) / (sp*sqrt((1/n1)+(1/n2)))
                
                t.alpha <- abs(qt(p = alpha/2, df = n1+n2-2))
                
                p.value.T0 <- pt(q = T0, df = n1+n2-2, lower.tail = FALSE)*2
                
                if (T0 > t.alpha) {
                        print("Rejeitar Hipótese Nula - Existe Diferença entre as Médias")
                        knitr::kable(data.frame(p.value.T0), align = 'c')
                }
                else {
                        print("Falhar em Rejeitar a Hipótese Nula - Não Exite Diferença Significativa  entre as Médias")
                        knitr::kable(data.frame(p.value.T0), align = 'c')}
        }
}

Dif.24h(mean1 = mu12h, sd1 = dp12h, mean2 = mu20h, sd2 = dp20h)
Dif.24h(mean1 = mu16h, sd1 = dp16h, mean2 = mu24h, sd2 = dp24h)
```

Através da análise do gráfico de série temporal da média da concentração de DBO a cada 4 horas é possível perceber variações do valor da mesma ao longo do dia. Realizou-se testes de hipótese para a variância e média da concentração de DBO de duas diferentes amostas horárias a fim de avaliar se a concentração de DBO horária média varia significativamente durante 24h de operação. O código acima apresenta a função Dif.24h (criada pelo usuário) para a avaliação da variância e desvio padrão de duas amostras horárias da concentração de DBO. Inicialmente, realiza-se um teste F para inferir sobre a variância de duas distribuições normais. Em seguida, realiza-se um teste T para inferir sobre a diferênça entre as médias de duas distribuições normais. Foram realizadas duas comparações. A primeira envole as amostra **12h** e **20h**. O teste aplicado falhou em rejeitar a hipótese de igualdade entres as concentrações médias de DBO nas amostras de **12h** e **20h**, confirmando o exposto pelo gráfico de série temporal. A segunda comparação envolve as amostras **16h** e **24h**. O teste aplicado rejeitou a hipótese nula de igualdade entre as concentrações médias de DBO, confirmando a existência de variação significativamente, utilizando um nível de significância de 10%, durante 24h de operação. A dificuldade com a abordagem "por comparação" para comparações múltiplas é a possibilidade do aumento da probabilidade do Erro Tipo I ou (equivalentemente) a possibilidade de diminuição do nível de confiança global. Logo uma correção do nível de significância ou do p-valor se faz necessária na realização de comparações múltiplas.

### Resposta letra c)

```{r}
mu     <- LQQU1.2$Media
xbarra <- LQQU1.2$Media*1.1
S      <- LQQU1.2$DP
n      <- rep(99,6)

T0            <- (xbarra - mu) / (S/sqrt(n))
probabilidade <- pt(q = T0, df = n-1, lower.tail = FALSE)*100

tabela           <- rbind(round(T0, digits = 2), round(probabilidade, digits = 2))
rownames(tabela) <- c("T0", "Probabilidade / %")
colnames(tabela) <- LQQU1.2$Amostra

knitr::kable(tabela, align = 'c')
```

O processo encontra-se sob controle pois a probabilidade dos valores médios em das observações em intervalos de quatro horas é inferior a 30% para todos os intervalos. 
